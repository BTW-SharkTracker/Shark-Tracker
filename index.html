<!DOCTYPE html>
<html>
<head>
	<title>Beneath the Waves</title>
	<script src="https://api.mapbox.com/mapbox-gl-js/v1.8.1/mapbox-gl.js"></script>
	<link href="https://api.mapbox.com/mapbox-gl-js/v1.8.1/mapbox-gl.css" rel="stylesheet" />
	<script src="https://d3js.org/d3.v5.min.js"></script>
	<script src='https://npmcdn.com/@turf/turf/turf.min.js'></script>
</head>
<style type="text/css">
	#map {
	    position:absolute;
	    width: 100%;
	    height: 100%;
	}
	svg {
	    position: absolute;
	    width: 100%;
	    height: 100%;
	}
</style>
<body>
	<hr>
	<div id='map' style='width: 1000px; height: 800px;'></div>
</body>
	<script type="text/javascript">

		mapboxgl.accessToken = 'pk.eyJ1IjoiYWczNzEzYSIsImEiOiJjazd1aG04MnUxYjU2M25rNWh5Nng2NmN6In0.4HUpNtdZx3kHM-dY4YY3GQ';



		var map = new mapboxgl.Map({
		container: 'map',
		style: 'mapbox://styles/mapbox/streets-v11',
		center: [-55.101, 37.877],
		zoom: 3,
		minZoom: 2,
		maxZoom: 8
		});

		var canvas = map.getCanvasContainer();

		d3.csv('Metadata_Sharks_ToJuly31_19.csv')
	    .then(function(data){
	      console.log(data);
	    })


			map.on('load', function() {
				map.addSource('10m-bathymetry-81bsvj', {
				type: 'vector',
				url: 'mapbox://mapbox.9tm8dx88'
				});

				map.addLayer(
				{
					'id': '10m-bathymetry-81bsvj',
					'type': 'fill',
					'source': '10m-bathymetry-81bsvj',
					'source-layer': '10m-bathymetry-81bsvj',
					'layout': {},
					'paint': {
					'fill-outline-color': 'hsla(337, 82%, 62%, 0)',
					'fill-color': [
						'interpolate',
						['cubic-bezier', 0, 0.5, 1, 0.5],
						['get', 'DEPTH'],
						200,
						'#78bced',
						9000,
						'#15659f'
						]
					}
				},
				'land-structure-polygon'
				);

				map.addSource('Nodes', {
					'type': 'geojson',
					'data': 'tracks.geojson'
				});


				d3.json("tracks.geojson", function(error, data) {

				    d3.csv("Metadata_Sharks_ToJuly31_19.csv", function(error, csv) {

				        //var world = data.features;

				        csv.forEach(function(d, i) {
				            geojson.forEach(function(e, j) {

											if (d['Shark ID'] === e['Shark ID']) {


												//Commn Name	Species Name	TagType	Name	TagDay	TagMonth
											//	TagYear	Total Length	Sex	Maturity	Track Color	Active?
													e['Commn Name'] = d['Commn Name']
													e['Species Name'] = d['Species Name']
													e['Name'] = d['Name']


												}

				            })
				        })
								

				    })

				})


				map.addLayer({
					'id': 'Nodes',
					'type': 'circle',
					'source': 'Nodes',
					'paint': {
						'circle-radius': 2,
						'circle-color': [
							'match',
							['get', 'Species Name'],
							'Prionace glauca',
							'#1f77b4',
							'Isurus oxyrinchus',
							'#ff7f0e',
							'Lamna nasus',
							'#2ca02c',
							'Galeocerdo cuvier',
							'#d62728',
							'Carcharhinus obscurus',
							'#9467bd',
							/* other */ '#2ca02c'
						]

						},
				});

			});


	</script>
