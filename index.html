<!DOCTYPE html>
<html>
<head>
	<meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
	<title>Beneath the Waves</title>
	<script src="https://api.mapbox.com/mapbox-gl-js/v1.9.0/mapbox-gl.js"></script>
	<link href="https://api.mapbox.com/mapbox-gl-js/v1.9.0/mapbox-gl.css" rel="stylesheet" />
	<script src="https://d3js.org/d3.v5.min.js"></script>
	<script src='https://npmcdn.com/@turf/turf/turf.min.js'></script>

</head>
<style type="text/css">
	#map {
	    position:absolute;
	    width: 100%;
	    height: 100%;
	}
	svg {
	    position: absolute;
	    width: 100%;
	    height: 100%;
	}
</style>
<body>
	<hr>
	<style>
	.mapboxgl-popup {
		max-width:400px;
		font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
		}

</style>
	<div id='map' style='width: 1400px; height: 650px;'></div>

	</body>
	<script type="text/javascript">

		mapboxgl.accessToken = 'pk.eyJ1IjoiYWczNzEzYSIsImEiOiJjazd1aG04MnUxYjU2M25rNWh5Nng2NmN6In0.4HUpNtdZx3kHM-dY4YY3GQ';

		var map = new mapboxgl.Map({
		container: 'map',
		style: 'mapbox://styles/mapbox/dark-v10',
		center: [-55.101826, 30.855898],
		zoom: 3,
		minZoom: 3,
		maxZoom: 6
		});


		var canvas = map.getCanvasContainer();

			map.on('load', function() {

				map.addSource('10m-bathymetry-81bsvj', {
				type: 'vector',
				url: 'mapbox://mapbox.9tm8dx88'
				});

				map.addLayer(
				{
					'id': '10m-bathymetry-81bsvj',
					'type': 'fill',
					'source': '10m-bathymetry-81bsvj',
					'source-layer': '10m-bathymetry-81bsvj',
					'layout': {},
					'paint': {
					'fill-outline-color': 'hsla(337, 82%, 62%, 0)',
					'fill-color': [
						'interpolate',
						['cubic-bezier', 0, 0.5, 1, 0.5],
						['get', 'DEPTH'],
						200,
							'#002c47',
							9000,
							'#00131f'
						]
					}
				},
				'land-structure-polygon'
				);

				map.addSource('Nodes', {
					'type': 'geojson',
					'data': 'tracksmeta.geojson'
				});




				map.addLayer({
					'id': 'Nodes',
					'type': 'circle',
					'source': 'Nodes',
					'paint': {
						'circle-radius': 2,
						'circle-color': [
							'match',
							['get', 'Species Name'],
							'Prionace glauca',
							'#1f77b4',
							'Isurus oxyrinchus',
							'#ff7f0e',
							'Lamna nasus',
							'#2ca02c',
							'Galeocerdo cuvier',
							'#d62728',
							'Carcharhinus obscurus',
							'#9467bd',
							/* other */ '#2ca02c'
						]},
						//filter out points based on data quality
							"filter":["any",
								["all", ["==","Commn Name","Tiger"],
								["any",["==","Class","A"],["==","Class","B"]]],
								["==","Class","0"],["==","Class","1"],
								["==","Class","2"],["==","Class","3"]]
				});
				//generate pop-up when a node is clicked on
				map.on('click', function (e) {
				    var features = map.queryRenderedFeatures(e.point, { layers: ['Nodes'] });

				    if (!features.length) {
				        return;
				    }

				    var feature = features[0];
				    var popup = new mapboxgl.Popup()
				        .setLngLat(feature.geometry.coordinates)
				        .setHTML('<h3><p>' +feature.properties['Name']+"</h3> "+"<h4>Common Name:</h4>"+feature.properties['Commn Name']+
								"</p><h4>Species: </h4>"+feature.properties['Species Name']
								+"<br/><h4>Date: </h4>"+feature.properties['Date'])
				        .addTo(map);
				});


				map.on('mousemove', function (e) {
				    var features = map.queryRenderedFeatures(e.point, { layers: ['Nodes'] });
				    map.getCanvas().style.cursor = (features.length) ? 'pointer' : '';
				});
				//filterBy(0);


			});


	</script>
