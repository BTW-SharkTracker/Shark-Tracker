<!DOCTYPE html>
<html>
<head>
	<meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
	<title>Beneath the Waves</title>
	<script src="https://api.mapbox.com/mapbox-gl-js/v1.9.0/mapbox-gl.js"></script>
	<link href="https://api.mapbox.com/mapbox-gl-js/v1.9.0/mapbox-gl.css" rel="stylesheet" />
	<link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Montserrat">
	<script src="https://d3js.org/d3.v5.min.js"></script>
	<script src='https://npmcdn.com/@turf/turf/turf.min.js'></script>

</head>
<style type="text/css">

#map {
  position: absolute;
  top: 0;
  bottom: 0;
  width: 100%;
}

h1 {

	font-family: 'Montserrat', sans-serif;
  font-size: 35px;
  line-height: 30px;
	font-weight: lighter;
	text-align: center;
	color: white;
}

h2 {
  font-size: 14px;
  line-height: 20px;
  margin-bottom: 10px;
}

a {
  text-decoration: none;
  color: #2dc4b2;
}

#console {
	position: fixed;
	top: 0;
  left: 30;
  width: 1400px;
	margin:auto;
  background-color: #97b4c2;
}
.session {
  margin-bottom: 20px;
}

.label {
  width: 7%;
  display: inline-block;
  text-align: center;
}
</style>
<body>
	<hr>
	<style>
	.mapboxgl-popup {
		max-width:400px;
		font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
		}

</style>

	<!-- Checkboxes to select which shark species are shown -->
	<input type="checkbox" id="all" onclick="allbtn()">
	<label for="all">All Sharks</label><br>
	<input type="checkbox" id="blue" onclick="bluebtn()">
	<label for="blue">Blue Sharks</label><br>
	<input type="checkbox" id="mako" onclick="makobtn()">
	<label for="mako">Shortfin Mako Sharks</label><br>
	<input type="checkbox" id="porbeagle" onclick="porbeaglebtn()">
	<label for="porbeagle">Porbeagle Sharks</label><br>
	<input type="checkbox" id="dusky" onclick="duskybtn()">
	<label for="dusky">Dusky Sharks</label><br>
	<input type="checkbox" id="tiger" onclick="tigerbtn()">
	<label for="tiger">Tiger Sharks</label><br>

	<div id='map' style='width: 1400px; height: 650px;'></div>
	<div id='console'>
  <h1>Beneath the Waves</h1>
</div>

	</body>
	<script type="text/javascript">

	// Variable holding the filters
	var Filters = ["any", ["all", ["==","Commn Name","Tiger"], ["any",["==","Class","A"],["==","Class","B"]]], ["==","Class","0"],["==","Class","1"],["==","Class","2"],["==","Class","3"]];

	// Variables of whether a checkbox is checked, and where in the filter array it is (maybe not the best way to do this?)
	var allOn = true;
	var blueOn = false;
	var blueLoc = 0;
	var makoOn = false;
	var makoLoc = 0;
	var porbeagleOn = false;
	var porbeagleLoc = 0;
	var duskyOn = false;
	var duskyLoc = 0;
	var tigersOn = false;
	var tigersLoc = 0;

		mapboxgl.accessToken = 'pk.eyJ1IjoiYWczNzEzYSIsImEiOiJjazd1aG04MnUxYjU2M25rNWh5Nng2NmN6In0.4HUpNtdZx3kHM-dY4YY3GQ';

		var map = new mapboxgl.Map({
		container: 'map',
		style: 'mapbox://styles/mapbox/dark-v10',
		center: [-55.101826, 30.855898],
		zoom: 3,
		minZoom: 3,
		maxZoom: 6
		});


		var canvas = map.getCanvasContainer();


			map.on('load', function() {

				map.addSource('10m-bathymetry-81bsvj', {
				type: 'vector',
				url: 'mapbox://mapbox.9tm8dx88'
				});

				map.addLayer(
				{
					'id': '10m-bathymetry-81bsvj',
					'type': 'fill',
					'source': '10m-bathymetry-81bsvj',
					'source-layer': '10m-bathymetry-81bsvj',
					'layout': {},
					'paint': {
					'fill-outline-color': 'hsla(337, 82%, 62%, 0)',
					'fill-color': [
						'interpolate',
						['cubic-bezier', 0, 0.5, 1, 0.5],
						['get', 'DEPTH'],
						200,
							'#002c47',
							9000,
							'#00131f'
						]
					}
				},
				'land-structure-polygon'
				);

				map.addSource('Nodes', {
					'type': 'geojson',
					'data': 'tracksmeta.geojson'
				});

				map.addLayer({
					'id': 'Nodes',
					'type': 'circle',
					'source': 'Nodes',
					'paint': {
						'circle-radius': 2,
						'circle-color': [
							'match',
							['get', 'Species Name'],
							'Prionace glauca',
							'#1f77b4',
							'Isurus oxyrinchus',
							'#ff7f0e',
							'Lamna nasus',
							'#2ca02c',
							'Galeocerdo cuvier',
							'#d62728',
							'Carcharhinus obscurus',
							'#9467bd',
							/* other */ '#2ca02c'
						]
						},
						//filter out points based on data quality
							"filter": Filters
				});


				 // map.setFilter('Nodes', ['==', "Date", "8/27/16 0:00"]);

				//generate pop-up when a node is clicked on
				map.on('click', function (e) {
				    var features = map.queryRenderedFeatures(e.point, { layers: ['Nodes'] });

				    if (!features.length) {
				        return;
				    }

				    var feature = features[0];
				    var popup = new mapboxgl.Popup()
				        .setLngLat(feature.geometry.coordinates)
				        .setHTML('<h3><p>' +feature.properties['Name']+"</h3> "+"<h4>Common Name:</h4>"+feature.properties['Commn Name']+
								"</p><h4>Species: </h4>"+feature.properties['Species Name']
								+"<br/><h4>Date: </h4>"+feature.properties['Date'])
				        .addTo(map);
				});


				map.on('mousemove', function (e) {
				    var features = map.queryRenderedFeatures(e.point, { layers: ['Nodes'] });
				    map.getCanvas().style.cursor = (features.length) ? 'pointer' : '';
				});


			});


			// Functions that run when a checkbox is clicked

			// This function tries, if button is already checked, to remove the tiger filter from the filters list and then set the filter back
			// IF the button isn't checked, it tries to append on the filter
			// There's something that isn't quite right though, and I'm confused about what it is at the moment.
			function tigerbtn() {
				if (tigersOn) {
					Filters.splice(tigersLoc);
					map.setFilter('Nodes', Filters);
					tigersOn = false;
				} else {
					Filters.push(["==","Species Name", 'Galeocerdo cuvier']);
					map.setFilter('Nodes', Filters);
					tigersOn = true;
					tigersLoc = Filters.length=1;
					console.log(Filters);
				}
			}

			function bluebtn() {
				if (blueOn) {
					Filters.splice(blueLoc);
					map.setFilter('Nodes', Filters);
					tigersOn = false;
				} else {
					Filters.push(["==","Species Name", 'Prionace glauca']);
					map.setFilter('Nodes', Filters);
					blueOn = true;
					blueLoc = Filters.length=1;
					console.log(Filters);
				}
			}

			// These are just the simple first try only set the new filter things
			function makobtn() {
				map.setFilter('Nodes', ["==","Species Name", 'Isurus oxyrinchus']);
			}

			function porbeaglebtn() {
				map.setFilter('Nodes', ["==","Species Name", 'Lamna nasus']);
			}

			function duskybtn() {
				map.setFilter('Nodes', ["==","Species Name", 'Carcharhinus obscurus']);
			}

			function allbtn() {
				map.setFilter('Nodes');
			}


	</script>
